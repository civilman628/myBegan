import numpy as np
import tensorflow as tf
import os
import Image
import base64


from trainer import Trainer
from config import get_config
from data_loader import get_loader
from utils import prepare_dirs_and_logger, save_config

os.environ["CUDA_VISIBLE_DEVICES"]="0"

def main(config):
    prepare_dirs_and_logger(config)

    rng = np.random.RandomState(config.random_seed)
    tf.set_random_seed(config.random_seed)

    if config.is_train:
        data_path = config.data_path
        batch_size = config.batch_size
        do_shuffle = True
    else:
        #setattr(config, 'batch_size', 1)
        if config.test_data_path is None:
            data_path = config.data_path
        else:
            data_path = config.test_data_path
        batch_size = config.sample_per_image
        do_shuffle = False
    print(data_path)
    data_loader = get_loader(
            data_path, config.batch_size, config.input_scale_size,
            config.data_format, config.split)
    trainer = Trainer(config, data_loader)

    if config.is_train:
        save_config(config)
        trainer.train()
    else:
        if not config.load_path:
            raise Exception("[!] You should specify `load_path` to load a pretrained model")
        imagestring0="data:image/jpeg;base64,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"
        
        ###string1=base64.encodestring(imagestring0)
        imagestring1=imagestring0

        #trainer.test2(imagestring0,imagestring1)
        trainer.test3( imagestring0, 128, 40)
        #trainer.test4('/home/scopeserver/RaidDisk/DeepLearning/mwang/data/gan_image/dress/test_dress_mean/*.jpg')
        #trainer.test4('/home/scopeserver/RaidDisk/DeepLearning/mwang/BEGAN-tensorflow/data/bag/splits/train/*.jpg')
        #trainer.test()

if __name__ == "__main__":
    config, unparsed = get_config()
    main(config)
